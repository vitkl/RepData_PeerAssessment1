---
title: "Reproducible Research: Peer Assessment 1"
author: "Vitalii Kleshchevnikov"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

Reading data - and quick look
``` {r loading} 
# setwd("./RepData_PeerAssessment1")
activity.dat = read.csv("activity.csv", colClasses = c("numeric", "Date","integer"),stringsAsFactors = F)
head(activity.dat)
str(activity.dat)
```
"spreading" data frame - so that each row contains all observations for each day,
intervals in columns
```{r transforming}
activity.dat.1row.per.interval = tidyr::spread(activity.dat, date, steps)
# cheking how data was spread - code below produces lond output - disabled
# str(activity.dat.1row.per.date)
# str(activity.dat.1row.per.interval)
```


## What is mean total number of steps taken per day?

Calculating total number of steps per day (NA omitted) - plotting histogram
```{r}
total_steps.per.day = colSums(activity.dat.1row.per.interval[,2:62], na.rm = T)

library(ggplot2)
qplot(x=total_steps.per.day, geom = "histogram", bins = 15) +
      xlab("the total number of steps taken each day") +
      ggtitle("Histogram of the total number of steps taken each day") +
      theme(title = element_text(size = rel(1.2)))
```

```{r}
mean_steps.per.day = format(round(mean(total_steps.per.day),0), scientific=F)
```
mean number of steps per day is `r mean_steps.per.day`

```{r}
median_steps.per.day = format(median(total_steps.per.day),scientific=F)
```
median number of steps per day is `r median_steps.per.day`


## What is the average daily activity pattern?
Calculating the mean number of steps per time interval (over all days) and
the interval contaning maximum number of steps
```{r}
mean_steps.per.interval = rowMeans(activity.dat.1row.per.interval[,2:61], na.rm = T)
max_step_interval = 
      activity.dat.1row.per.interval$interval[mean_steps.per.interval == max(mean_steps.per.interval)]
```

```{r}
qplot(x = activity.dat.1row.per.interval$interval, y = mean_steps.per.interval) + 
      geom_path() +
      xlab("time interval") +
      ylab("mean number of steps")+
      ggtitle("the average (mean) number of steps taken in different intervals during the day") +
      theme(title = element_text(size = rel(1)))
```

The interval contaning maximum number of steps (on average(mean) across all days) - `r max_step_interval`


## Imputing missing values

```{r}
missing_rows = sum(!complete.cases(activity.dat))
```
the number of rows missing observations is `r missing_rows`

Imputing missing values by setting each missing observation (steps) to be equal 
to the mean number of steps taken in that interval
```{r}
activity.dat.1row.per.interval.imputed = activity.dat.1row.per.interval
activity.dat.1row.per.interval.imputed[is.na(activity.dat.1row.per.interval)] = mean_steps.per.interval
```
Calculating total number of steps per day (NA imputed) - plotting histogram
```{r}
total_steps.per.day.imputed = 
      colSums(activity.dat.1row.per.interval.imputed[,2:62], na.rm = F)

library(ggplot2)
qplot(x=total_steps.per.day.imputed, geom = "histogram", bins = 15) + 
      xlab("the total number of steps taken each day") +
      ggtitle("Histogram of the total number of steps taken each day \n (after missing values were imputed)") +
      theme(title = element_text(size = rel(1.2)))
```

```{r}
mean_steps.per.day.imputed = format(round(mean(total_steps.per.day.imputed),0),scientific=F)
```
mean number of steps per day after imputing is `r mean_steps.per.day.imputed`.
Imputing missing values moves mean towards the median, thus making it more 
descriptive.

```{r}
median_steps.per.day.imputed = format(median(total_steps.per.day.imputed),scientific=F)
```
Median number of steps per day after imputing is `r median_steps.per.day`. 
Imputing missing values doesn't change median at all.

## Are there differences in activity patterns between weekdays and weekends?

```{r weekdays_transforming_data}
activity.dat.weekdays = cbind(activity.dat.1row.per.interval.imputed, activity.dat.1row.per.interval.imputed)
weekdays(as.Date(colnames(activity.dat.1row.per.interval.imputed)[2:62]))
```